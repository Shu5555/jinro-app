# JinroApp プロジェクトメモ

## 概要

このプロジェクトは、人狼ゲームのGM（ゲームマスター）を支援するためのWebアプリケーションです。
参加者に役職を割り当て、各プレイヤーが個別に役職を確認できる機能を提供します。

また、Googleフォームで収集した役職案のCSVファイルを、このアプリケーションで利用可能な形式に変換するサブツールも含まれています。

## プロジェクト構成

- `/index.html`: GMが参加者や役職の数を設定し、役職を割り当てるためのメインページ。
- `/player.html`: 各プレイヤーが合言葉を使って自分の役職を確認するためのページ。
- `/random.html`: プレイヤーのランダム抽選やコイントスができる補助ツールページ。
- `/script.js`: 上記のHTMLファイルの動作を制御するメインのJavaScriptファイル。
- `/style.css`: アプリケーション全体のデザインを定義するCSSファイル。
- `/roles.csv`: 役職のデータが格納されているCSVファイル。以下の形式である必要があります。
  - `役職名,陣営,能力,勝利条件,制作者`
- `/CsvConverterApp/`: Googleフォーム用のCSVを変換するツールのディレクトリ。
  - `index.html`: 変換ツールのUI。
  - `script.js`: 変換ロジック。

## 主な機能と開発経緯

### 基本機能
- **役職割り当て機能**: GMが参加者リストと各陣営の人数を入力すると、ランダムに役職を割り当て、プレイヤー確認用のURLと合言葉を生成します。
- **役職確認機能**: プレイヤーは共有されたURLにアクセスし、GMから伝えられた合言葉を入力することで、自分の役職、能力、勝利条件などを確認できます。
- **CSV変換ツール**: `CsvConverterApp` を使うことで、Googleフォームで集計した特定の形式のCSVを、`JinroApp`で読み込み可能な`roles.csv`の形式に変換できます。

### v0.2.0での主な変更

- **ランダムツールページの追加 (`random.html`)**
  - **プレイヤー抽選機能**: 参加者リストの中から、指定した人数をランダムに抽選します。抽選対象とするプレイヤーはチェックボックスで選択可能です。GMツールで生成した共有URLからアクセスすると、参加者リストが自動で入力されます。
  - **コイントス機能**: 表の出る確率をパーセントまたは分数で指定して、コイントスを実行できます。

- **データ連携とUIの改善**
  - **共有URLの拡張**: GMツールで生成される共有URLに、ゲームの参加者情報（`bin`パラメータ）が含まれるようになりました。このURLを使うことで、`player.html`や`random.html`でプレイヤー情報を自動的に読み込めます。
  - **フッターナビゲーション**: 全てのページにフッターナビゲーションを設置し、各ツール間をスムーズに移動できるようにしました。ゲームIDはリンク間で引き継がれます。
  - **レイアウトの統一**: 全てのページのレイアウトを中央揃えに統一し、PC、タブレット、スマートフォンなどの異なる画面サイズでも表示が崩れないように、レスポンシブ対応を強化しました。

- **バグ修正と安定性の向上**
  - **データ復号化のバグ修正**: `JSONBin.io`を利用した共有URLから、役職データを正常に復号化できない問題を修正しました。
  - **ゲーム進行状況メーカーの修正**: プレイヤーの「生存」「死亡」ボタンの表示と機能が、ページのリロード後も正しく維持されるように修正しました。また、表示設定（陣営人数/役職名）のトグルボタンが確実に機能するようにイベント処理を改善しました。
  - **GMツールの状態復元バグの修正**: ページをリロードした際に、「共有情報をコピー」ボタンが機能しなくなる問題や、「GM確認用リスト」が非表示になる問題を修正しました。`sessionStorage`を利用した状態管理のロジックを見直し、安定性を向上させました。
  - **CSV読み込みバグの修正**: 役職データ（`roles.csv`）の自動および手動読み込みが機能しない問題を修正しました。

### v0.1.15以前の主な機能

- **ゲーム進行状況メーカー**: 経過日数とプレイヤーの生死状況を管理し、Discordなどに共有するための進行状況テキストを生成する機能。
- **状態保存と復元**: ブラウザのセッションストレージを利用して、ゲームの作業状態を自動的に保存・復元する機能。
- **`roles.csv`の自動読み込み**: アプリケーション起動時に、プロジェクトルートにある`roles.csv`ファイルを自動的に読み込む機能。
- **合言葉の自動生成とユニーク化**: 日本語の食べ物名リストから、重複しない合言葉を自動的に生成する機能。
- **UTF-8文字のエンコード問題の修正**: 日本語などのマルチバイト文字を正しく暗号化・復号化できるように修正。

## 技術的詳細

### データ永続化
- **JSONBin.io**: ゲームの役職割り当てデータをサーバーに保存し、ユニークなURL（`bin`パラメータ付き）を生成するために利用します。
- **Session Storage**: GMツールの入力状態（参加者リスト、人数設定など）をブラウザのセッション内に保存し、リロード時の状態復元に利用します。

### 暗号化
- プレイヤーの役職情報は、簡易的なXOR暗号化とBase64エンコーディングを用いて保護され、URLパラメータとして安全に受け渡しされます。

### フロントエンド
- HTML, CSS, JavaScriptのみで構成された静的なWebアプリケーションです。
- レスポンシブデザインを採用し、様々なデバイスに対応しています。

---

**現在のバージョン**: v0.2.0  
**制作者**: shu5555  
**最終更新**: 2024年